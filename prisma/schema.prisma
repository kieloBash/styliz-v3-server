generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  SELLER
  ADMIN
}

model User {
  id    Int     @id @default(autoincrement())
  email String  @unique
  name  String?

  userProfile UserProfile?
  role        Role         @default(SELLER)
  password    String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  shifts   Shift[]
  invoices Invoice[]
}

model UserProfile {
  id        Int     @id @default(autoincrement())
  userId    Int     @unique
  avatarUrl String?
  color     String?
  rate      Float?  @default(400)

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
}

enum ShiftType {
  MORNING
  AFTERNOON
  EVENING
}

enum ShiftStatus {
  NO_SHOW
  COMPLETED
  CANCELLED
  ASSIGNED
}

model Shift {
  id        Int         @id @default(autoincrement())
  userId    Int
  startTime DateTime
  endTime   DateTime?
  type      ShiftType
  status    ShiftStatus @default(ASSIGNED)

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
}

model Customer {
  id   Int    @id @default(autoincrement())
  name String @unique

  invoices Invoice[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum InvoiceStatus {
  JOYJOY
  RTS
  COMPLETED
}

model Invoice {
  id Int @id @default(autoincrement())

  items    Item[]
  subTotal Int
  freebies Int?          @default(0)
  status   InvoiceStatus @default(COMPLETED)

  dateDelivered DateTime
  dateIssued    DateTime @default(now())
  updatedAt     DateTime @updatedAt

  customerId Int
  customer   Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)

  sellerId Int
  seller   User @relation(fields: [sellerId], references: [id], onDelete: Cascade)

  platformId Int
  platform   Platform @relation(fields: [platformId], references: [id], onDelete: Cascade)

  @@index([dateDelivered])
  @@index([dateIssued])
  @@index([customerId])
  @@index([sellerId])
  @@index([platformId])
}

model ItemCategory {
  id   Int    @id @default(autoincrement())
  name String @unique

  items       Item[]
  quickPrices Int[]
  color       String?
  icon        String?
}

enum ItemStatus {
  CANCELLED
  JOYJOY
  RTS
  COMPLETED
}

model Item {
  id        Int @id @default(autoincrement())
  invoiceId Int

  price      Int
  categoryId Int
  status     ItemStatus @default(COMPLETED)

  invoice  Invoice      @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  category ItemCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([invoiceId])
  @@index([categoryId])
}

model Platform {
  id   Int    @id @default(autoincrement())
  name String @unique

  invoices Invoice[]
}
